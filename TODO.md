1. 这两天x402大火，带火了#Ping，#PayAI等标的的同时，也唤起了我的一些远古+近期记忆
x402从定义上来讲，是Agent之间基于Crypto的支付协议。从具体场景来说，主要就是Agent之间的微支付/按需支付
殊不知微支付/按需支付这个东西，而圈不是第一次搞，而是第N次了

2.Monad x X402
我们鼓励开发者积极探索与 X402 协议相结合的创新方向，利用 Monad 的高性能并行处理能力，在支付与金融应用领域开拓新的想象空间。这将是您项目的一个独特亮点!

3.**开发任务说明书**。

> 🎯 结论：
> **你主要要开发 3 个合约，每个负责一块：分账 / 一次性打赏 / 流式打赏。**

---

## ① RevenueShare402（分账 + 402 适配合约）

**一句话：**
专门负责“这笔钱按什么比例分给谁”，并且真正去调用 X402 协议完成分账。

**它干的事：**

* 保存“分账方案”（scheme）：

  * 比如：主播 90% + 平台 5% + 推荐人 5%
* 提供一个统一入口方法（比如 `_distribute(schemeId, amount)`）
  → 上层业务只要丢金额和方案 id 进来就行
* 在内部把：

  * 收款人数组 + 分成比例数组 + 金额
    组装好后，调用：
  * `X402Router.split(...)` 完成真正的链上分账
* 相当于你项目里的 **「支付/分账网关」**

> 所有要分钱的场景（一次性打赏、流式打赏）最终都要走它。

---

## ② LiveRoom（直播间 + 一次性打赏合约）

**一句话：**
管理直播间信息，处理**“点一下就打赏一笔”**这种一次性的打赏逻辑。

**它干的事：**

* 管理直播间：

  * roomId → 主播地址
  * roomId → 使用哪个分账方案（schemeId）
  * room 是否启用
* 提供一次性打赏入口：

  * `tip(roomId)`，用户直接附带 value 调用
* 在打赏时：

  * 查出 room 的 `schemeId`
  * 把金额和 `schemeId` 丢给 `RevenueShare402._distribute(...)`
* 发出事件（event）给前端：

  * 比如 `Tipped(roomId, from, amount)`，用来做弹幕、榜单、统计

> 它不直接管怎么算比例、分钱给谁，那是 RevenueShare402 的工作。
> 它只负责“直播一次性打赏”这个业务。

---

## ③ TipStream（流式打赏合约）

**一句话：**
实现**“按时间持续打赏”**，即用户一键开启，过一段时间停止，期间按秒计费，最后结算一次。

**它干的事：**

* 为每个用户维护一个“打赏流”：

  * 给哪个 room 打赏
  * 从什么时候开始
  * 每秒多少钱（ratePerSecond）
  * 当前是否在流式打赏中
* 提供两个核心入口：

  * `startStream(roomId, ratePerSecond)` → 开始流式打赏
  * `stopStream()` → 停止并结算
* 在 `stopStream()` 里计算：

  * `amount = (当前时间 - startTime) * ratePerSecond`
  * 找到这个 room 对应的 `schemeId`
  * 把 `amount + schemeId` 丢给 `RevenueShare402._distribute(...)`
* 同样发事件：

  * `StreamStarted(...)`、`StreamStopped(...)`，前端可以根据这个做动态 UI

> 它和 LiveRoom 的区别：
>
> * LiveRoom：一次打赏一笔，用户每点一次就是一单
> * TipStream：用户只点两次（开 / 关），中间按时间计费

---

## 🔚 一张表帮你再过一遍

| 合约名             | 主要职责               | 是否直接调用 402               |
| --------------- | ------------------ | ------------------------ |
| RevenueShare402 | 管分账方案 + 调用 X402 分账 | ✅ 是，直接调                  |
| LiveRoom        | 直播间管理 + 一次性打赏      | ❌ 不直接调，走 RevenueShare402 |
| TipStream       | 流式打赏（按秒计费）+ 结算     | ❌ 不直接调，走 RevenueShare402 |

你可以这样理解：

> **RevenueShare402 = 支付内核**
> **LiveRoom / TipStream = 两种不同形态的“打赏产品”，都复用这套内核。**

如果你愿意，下一步我可以帮你写一段 README / 设计说明，把这 3 个合约的职责写成正式文档风格，直接放在仓库里用。
